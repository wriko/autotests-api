Запуск автотестов и генерация Allure отчета


Теперь, когда все настроено для работы с Allure, самое время запустить автотесты и сгенерировать отчет.

----------------------------
Запуск автотестов
----------------------------

Для генерации базового отчета достаточно добавить флаг --alluredir=./allure-results, где ./allure-results — это папка, в которой будут сохраняться результаты выполнения автотестов. Пример команды для запуска всех API автотестов:

    python -m pytest -m "regression" --alluredir=./allure-results

Эта команда запустит тесты, как обычно, но теперь в проекте появится папка allure-results с результатами тестов. Если открыть папку, то можно увидеть файлы в формате .json:

.
└── allure-results/
    ├── 0cc0666b-1ca5-4933-a2ea-63e2edc899ac-container.json
    ├── 0efa87d0-f3f7-4783-8cc7-50ead3f3cdbe-container.json
    ├── 4a1c515d-3e45-4a71-b34b-914175b6dc0f-container.json
    ├── 4d4adb1b-64c9-4772-94cd-729b74bc2afe-container.json
    ├── 5a860776-4946-406d-8fce-31f6fd331acc-result.json
    ├── 5cecd4b7-6a1f-483e-ad1b-c3f7236a439d-container.json
    ├── 7ac475f1-58f0-4aa4-81dc-4532f5e56c2d-container.json
    └── # И так далее

Эти файлы содержат информацию о выполнении автотестов и необходимы для создания отчета.

----------------------------
Генерация отчета
----------------------------
Allure поддерживает два способа генерации отчетов:
 - Генерация статического отчета — создает файлы, которые можно открыть в браузере локально или передать кому-то в виде архива. Такой отчет можно разместить в файловом хранилище, и для его просмотра не требуется установка Allure.
 - Генерация динамического отчета — Allure локально запускает сервер с отчетом, который можно быстро открыть в браузере. Это удобный способ для локального использования, но отчетом нельзя поделиться напрямую.

Оба подхода полезны в зависимости от целей, рассмотрим их подробнее.

Генерация статического отчета
Для генерации статического отчета выполните команду:

    allure generate ./allure-results --output=./allure-report

Вывод в консоль при успешном выполнении команды:

    (.venv) username@ip-8-8-8-8 autotests-api % allure generate ./allure-results --output=./allure-report
    --output=./allure-report does not exist
    Report successfully generated to allure-report

При успешном выполнении команда создаст папку allure-report с содержимым:

.
└── allure-report/
    ├── data
    ├── export
    ├── history
    ├── plugin
    ├── widgets
    ├── app.js
    ├── favicon.ico
    ├── index.html
    └── styles.css

Файл index.html можно открыть в браузере, чтобы увидеть сгенерированный отчет. Либо можно запустить локальный сервер для просмотра отчета:

    allure open ./allure-report


Этот способ удобен, когда нужно сохранить отчет для последующего просмотра или отправить коллегам.



Генерация динамического отчета
Для динамической генерации отчета используется команда:

     allure serve ./allure-results


Эта команда:

Генерирует временный отчет.
Запускает локальный сервер.
Автоматически открывает отчет в браузере.
Пример вывода в консоль:

    (.venv) username@ip-8-8-8-8 autotests-api % allure serve ./allure-results
    Generating report to temp directory...
    Report successfully generated to /var/folders/x9/mn6w1bg119b20c2wg5n4s_6m0000gn/T/15740738898729010750/allure-report
    Starting web server...
    2024-10-16 21:28:29.975:INFO::main: Logging initialized @1466ms to org.eclipse.jetty.util.log.StdErrLog
    Server started at <http://192.168.8.7:53859/>. Press <Ctrl+C> to exit

Чтобы остановить сервер, нужно нажать Ctrl+C в консоли.



Наполнение отчета
Если вы посмотрите текущий отчет, то заметите, что в нем отсутствует подробная информация по каждому автотесту. Например, шаги тестов, вложенные действия или дополнительные данные не отображаются. Это связано с тем, что для базового отчета такая информация не прикладывается.

В следующих уроках мы добавим более детализированное наполнение, чтобы отчет включал:

Шаги выполнения тестов.
Скриншоты на момент ошибки или успешного выполнения.
Логи браузера и сервера.
Дополнительную информацию о времени выполнения каждого шага.
Эти элементы сделают отчет более информативным и помогут легко находить проблемы в случае провала тестов.

Резюме
Мы рассмотрели два способа генерации Allure отчетов: статический и динамический. Оба варианта полезны в зависимости от сценария. В большинстве случаев локально удобнее использовать команду allure serve, а для публикации отчета — статический файл index.html.